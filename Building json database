import os

import numpy as np
import json
import glob
import spacy
import pandas as pd
import pdfplumber
import PyPDF2
import re
import tkinter as tk
from tkinter import filedialog
filename = "/Users/kylenabors/Documents/GitHub/MS-Thesis/Training Data/Fed Data/fed_database.json"

def Choices():
    print("Fed Documents")
    print("Data Managment Systmem")
    print("(1) View Data")
    print("(2) Edit Data")
    print("(3) Remove Duplicates")
    print("(4) Delete Entry")
    print("(5) Exit")
    
def view_data():
    with open(filename, "r") as f:
        data = json.load(f)
    for entry in data:
        name = entry["name"]
        date = entry["date"]
        type = entry["type"]
        print(f"Name of Document: {name}")
        print(f"Date of Document: {date}")
        print(f"Type of Document: {type}")
        if "path" in entry:
            path = entry["path"]
            print(f"File Path: {path}")
        else:
            print("File Path: Not available")
        print("\n\n")


def add_data():
    root = tk.Tk()
    root.withdraw()  # we don't want a full GUI, so keep the root window from appearing
    directory_path = filedialog.askdirectory()  # open the directory chooser dialog
    file_types = ['Speeches', 'Press Releases']
    for file_type in file_types:
        files = glob.glob(f"{directory_path}/{file_type}/*.pdf")
        for file in files:
            item_data = {}
            item_data["name"] = file.split("/")[-1]
            item_data["date"] = "".join(re.findall(r'\d+', item_data["name"]))
            item_data["type"] = file_type
            item_data["path"] = file
            with open (filename, "r") as f:
                temp = json.load(f)
                temp.append(item_data)
                with open(filename, "w") as f:
                    json.dump(temp, f, indent=4)


        
def delete_entry():
    with open(filename, "r") as f:
        data = json.load(f)

    name_to_delete = input("Enter the name of the document to delete: ")

    data = [entry for entry in data if entry["name"] != name_to_delete]

    with open(filename, "w") as f:
        json.dump(data, f, indent=4)

def remove_duplicates():
    with open(filename, "r") as f:
        data = json.load(f)

    data_no_duplicates = []
    seen_names = set()
    for entry in data:
        if entry["name"] not in seen_names:
            data_no_duplicates.append(entry)
            seen_names.add(entry["name"])

    with open(filename, "w") as f:
        json.dump(data_no_duplicates, f, indent=4)

while True:
    Choices()
    choice = input("\nEnter Number: ")
    if choice == "1":
        view_data()
    elif choice == "2":
        add_data()
    elif choice == "3":
        remove_duplicates()
    elif choice == "4":
        delete_entry()
    elif choice == "5":
        print("Exit")
        break
    else:
        print("Invalid Input")
